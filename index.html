<!doctype html>
<html lang="vi">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>eTCTHA</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
		<style>
			:root {
				--bg-1: #0b2e22;
				--bg-2: #0f3b2a;
				--accent-1: #79c08e;
				--accent-2: #42a66b;
				--text: #eaf2ed;
				--muted: #bcd7c6;
				--card: rgba(255,255,255,0.08);
				--card-border: rgba(255,255,255,0.14);
				--shadow: 0 10px 24px rgba(0,0,0,0.35);
			}

			* { box-sizing: border-box; }
			html, body { height: 100%; }
			body {
				margin: 0;
				font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
				color: var(--text);
				background:
					radial-gradient(1200px 600px at 10% 0%, #123f2f 10%, var(--bg-1) 40%, var(--bg-2) 100%),
					linear-gradient(180deg, rgba(121,192,142,0.08), rgba(66,166,107,0.04));
				background-attachment: fixed;
			}

			/* Subtle leaf pattern overlay */
			body::before {
				content: '';
				position: fixed;
				inset: 0;
				background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'><g fill='none' stroke='%23ffffff' stroke-opacity='0.06'><path d='M80 20c26 26 26 66 0 92c-26-26-26-66 0-92z'/><path d='M20 80c26-26 66-26 92 0c-26 26-66 26-92 0z'/></g></svg>");
				background-size: 180px 180px;
				opacity: 0.6;
				pointer-events: none;
			}

			header {
				position: sticky;
				top: 0;
				z-index: 10;
				backdrop-filter: blur(8px);
				background: linear-gradient(180deg, rgba(12,44,33,0.7), rgba(12,44,33,0.45));
				border-bottom: 1px solid var(--card-border);
			}
			.nav {
				max-width: 1100px;
				margin: 0 auto;
				padding: 16px 20px;
				display: flex;
				align-items: center;
				gap: 16px;
			}
			.brand {
				font-weight: 600;
				letter-spacing: 0.8px;
				font-size: 20px;
				display: inline-flex;
				align-items: center;
				gap: 10px;
			}
			.brand-icon {
				width: 26px; height: 26px;
				display: inline-block;
				background: conic-gradient(from 180deg at 50% 50%, var(--accent-1), var(--accent-2));
				border-radius: 8px;
				box-shadow: inset 0 0 8px rgba(255,255,255,0.25);
			}

			main { max-width: 1100px; margin: 0 auto; padding: 28px 20px 60px; }
			.intro {
				display: flex; align-items: center; justify-content: space-between; gap: 14px; flex-wrap: wrap;
				margin-bottom: 18px;
			}
			.intro h1 { font-size: 18px; font-weight: 500; margin: 0; color: var(--muted); }

			.add-btn {
				display: inline-flex; align-items: center; gap: 10px;
				background: linear-gradient(180deg, var(--accent-1), var(--accent-2));
				color: #07341f; border: none; border-radius: 10px;
				padding: 10px 14px; font-weight: 600; cursor: pointer;
				box-shadow: 0 6px 16px rgba(66,166,107,0.35);
			}
			.add-btn:hover { filter: brightness(1.05); }
			.add-btn:active { transform: translateY(1px); }

			.grid {
				display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px;
			}
			@media (max-width: 900px) { .grid { grid-template-columns: repeat(8, 1fr); } }
			@media (max-width: 640px) { .grid { grid-template-columns: repeat(4, 1fr); } }

			.card {
				grid-column: span 12;
				background: var(--card);
				border: 1px solid var(--card-border);
				border-radius: 16px; padding: 14px 14px;
				box-shadow: var(--shadow);
				backdrop-filter: blur(10px);
			}
			@media (min-width: 640px) { .card { grid-column: span 6; } }
			@media (min-width: 900px) { .card { grid-column: span 4; } }

			.row { display: grid; grid-template-columns: 1.4fr 1.2fr auto; gap: 10px; align-items: center; }
			@media (max-width: 640px) { .row { grid-template-columns: 1fr; } }

			label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
			.input {
				width: 100%;
				padding: 10px 12px;
				border-radius: 12px;
				background: rgba(255,255,255,0.06);
				border: 1px solid rgba(255,255,255,0.18);
				color: var(--text);
				outline: none;
			}
			.input::placeholder { color: rgba(234,242,237,0.6); }
			.input:focus { border-color: var(--accent-1); box-shadow: 0 0 0 3px rgba(121,192,142,0.25); }

			/* View mode pills */
			.pill {
				display: inline-block;
				width: 100%;
				padding: 10px 12px;
				border-radius: 12px;
				background: rgba(255,255,255,0.06);
				border: 1px solid rgba(255,255,255,0.18);
				color: var(--text);
				text-decoration: none;
				word-break: break-word;
			}
			.pill.link:hover { border-color: var(--accent-1); }

			.actions { display: flex; flex-direction: column; gap: 8px; align-items: stretch; }
			.btn {
				padding: 8px 10px;
				border-radius: 10px; border: 1px solid rgba(255,255,255,0.18);
				background: rgba(255,255,255,0.08); color: var(--text);
				cursor: pointer;
			}
			.btn.primary { background: linear-gradient(180deg, var(--accent-1), var(--accent-2)); color: #07341f; border: none; }
			.btn:hover { filter: brightness(1.05); }

			.footer { color: var(--muted); text-align: center; margin-top: 26px; font-size: 12px; }
		</style>
	</head>
	<body>
		<header>
			<nav class="nav">
				<div class="brand">
					<span class="brand-icon" aria-hidden="true"></span>
					eTCTHA H√Ä Tƒ®NH
				</div>
			</nav>
		</header>

		<main>
			<div class="intro">
				<h1>Danh s√°ch li√™n k·∫øt thi√™n nhi√™n ‚Äî th√™m, m·ªü nhanh.</h1>
				<button class="add-btn" id="addCard" type="button" aria-label="Th√™m √¥">
					<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
						<path d="M12 5v14M5 12h14" stroke="#063824" stroke-width="2" stroke-linecap="round"/>
					</svg>
					Th√™m √¥
				</button>
			</div>

			<section class="grid" id="grid"></section>

			<div class="footer">Made with üåø ‚Äî eTCTHA</div>
		</main>

		<!-- Optional: enable shared persistence by providing Supabase config below.
		Add your project URL and public anon key, then uncomment.
		<script>
			// window.ETCTHA_CONFIG = { url: 'https://YOUR-project.supabase.co', key: 'YOUR_PUBLIC_ANON_KEY' };
		</script>
		-->
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
		<script>
			const grid = document.getElementById('grid');
			const addCardBtn = document.getElementById('addCard');
			const STORAGE_KEY = 'etctha_items_v1';
			const CONFIG = window.ETCTHA_CONFIG || null;
			let supa = null;
			if (CONFIG && window.supabase) {
				try { supa = window.supabase.createClient(CONFIG.url, CONFIG.key); } catch {}
			}
			const remoteEnabled = () => !!supa;

			function saveAll() {
				const items = [...grid.querySelectorAll('.card')].map(card => ({
					name: card.dataset.name || '',
					link: card.dataset.link || ''
				})).filter(it => it.name || it.link);
				try { localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); } catch {}
			}

			function loadAll() {
				try {
					const raw = localStorage.getItem(STORAGE_KEY);
					if (!raw) return [];
					const items = JSON.parse(raw);
					return Array.isArray(items) ? items : [];
				} catch { return []; }
			}

			// Remote persistence helpers (Supabase)
			async function remoteLoad() {
				if (!remoteEnabled()) return [];
				try {
					const { data, error } = await supa
						.from('links')
						.select('id,name,url,created_at')
						.order('created_at', { ascending: false });
					if (error) return [];
					return data || [];
				} catch { return []; }
			}

			async function remoteUpsert(item) {
				if (!remoteEnabled()) return;
				try { await supa.from('links').upsert(item); } catch {}
			}

			async function remoteDelete(id) {
				if (!remoteEnabled()) return;
				try { await supa.from('links').delete().eq('id', id); } catch {}
			}

			function normalizeUrl(raw) {
				if (!raw) return '';
				let url = raw.trim();
				if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
				return url;
			}

			function displayText(raw) {
				if (!raw) return '‚Äî';
				return raw.trim().replace(/^https?:\/\//i, '');
			}

			function createCard(name = '', link = '', mode = 'view', id = null) {
				const card = document.createElement('div');
				card.className = 'card';
				const state = { name, link };
				const generatedId = (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : (Date.now() + '_' + Math.random().toString(36).slice(2));
				const itemId = id || generatedId;
				card.dataset.id = itemId;
				card.dataset.name = state.name;
				card.dataset.link = state.link;

				function renderView() {
					const href = normalizeUrl(state.link);
					card.innerHTML = `
						<div class="row">
							<div>
								<label>T√™n</label>
								<span class="pill">${state.name || '‚Äî'}</span>
							</div>
							<div>
								<label>ƒê∆∞·ªùng link</label>
								<a class="pill link" href="${href}" target="_blank" rel="noopener">${displayText(state.link)}</a>
							</div>
							<div class="actions">
								<button class="btn" data-action="edit">S·ª≠a</button>
								<button class="btn" data-action="remove">X√≥a</button>
							</div>
						</div>
					`;

					card.querySelector('[data-action="edit"]').addEventListener('click', renderEdit);
					card.querySelector('[data-action="remove"]').addEventListener('click', async () => { card.remove(); saveAll(); await remoteDelete(itemId); });
				}

				function renderEdit() {
					card.innerHTML = `
						<div class="row">
							<div>
								<label for="name">T√™n</label>
								<input class="input" name="name" placeholder="V√≠ d·ª•: R·ª´ng Tr√†m" value="${state.name}" />
							</div>
							<div>
								<label for="link">ƒê∆∞·ªùng link</label>
								<input class="input" name="link" placeholder="V√≠ d·ª•: cantho.vn/tra-su" value="${state.link}" />
							</div>
							<div class="actions">
								<button class="btn primary" data-action="save">L∆∞u</button>
								<button class="btn" data-action="remove">X√≥a</button>
							</div>
						</div>
					`;

					const nameInput = card.querySelector('input[name="name"]');
					const linkInput = card.querySelector('input[name="link"]');
					card.querySelector('[data-action="save"]').addEventListener('click', async () => {
						state.name = nameInput.value.trim();
						state.link = linkInput.value.trim();
						card.dataset.name = state.name;
						card.dataset.link = state.link;
						saveAll();
						await remoteUpsert({ id: itemId, name: state.name, url: state.link });
						renderView();
					});
					card.querySelector('[data-action="remove"]').addEventListener('click', async () => { card.remove(); saveAll(); await remoteDelete(itemId); });
					nameInput.focus();
				}

				if (mode === 'edit') renderEdit(); else renderView();
				grid.appendChild(card);
				return card;
			}

			addCardBtn.addEventListener('click', () => createCard('', '', 'edit'));

			// Load items: prefer remote if configured; else localStorage; else samples
			(async () => {
				if (remoteEnabled()) {
					const remote = await remoteLoad();
					if (remote.length) {
						remote.forEach(it => createCard(it.name || '', it.url || '', 'view', it.id));
						return;
					}
				}
				const existing = loadAll();
				if (existing.length) {
					existing.forEach(it => createCard(it.name || '', it.link || '', 'view'));
				} else {
					createCard('Khu b·∫£o t·ªìn Tr√† S∆∞', 'trasu.vn', 'view');
					createCard('V∆∞·ªùn Qu·ªëc gia U Minh', 'nonglam.gov.vn/u-minh', 'view');
				}
			})();
		</script>
	</body>
</html>
